VERSION 5.00
Begin VB.Form Capture 
   BackColor       =   &H00221C13&
   BorderStyle     =   0  'None
   Caption         =   "iCee½ØÆÁ"
   ClientHeight    =   3345
   ClientLeft      =   0
   ClientTop       =   0
   ClientWidth     =   5595
   DrawWidth       =   3
   Icon            =   "½ØÆÁ.frx":0000
   KeyPreview      =   -1  'True
   LinkTopic       =   "Form1"
   ScaleHeight     =   3345
   ScaleWidth      =   5595
   ShowInTaskbar   =   0   'False
   Begin VB.PictureBox ph 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      ForeColor       =   &H80000008&
      Height          =   510
      Left            =   4560
      Picture         =   "½ØÆÁ.frx":038A
      ScaleHeight     =   32
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   32
      TabIndex        =   27
      Top             =   1080
      Visible         =   0   'False
      Width           =   510
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H00C0C0C0&
      BorderStyle     =   0  'None
      Height          =   390
      Left            =   0
      ScaleHeight     =   26
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   241
      TabIndex        =   24
      Top             =   0
      Visible         =   0   'False
      Width           =   3620
      Begin VB.Image Image2 
         Height          =   240
         Index           =   3
         Left            =   3240
         Picture         =   "½ØÆÁ.frx":0C54
         ToolTipText     =   "ÍË³ö½ØÆÁ"
         Top             =   75
         Width           =   240
      End
      Begin VB.Image Image2 
         Height          =   240
         Index           =   2
         Left            =   2440
         Picture         =   "½ØÆÁ.frx":0FDE
         ToolTipText     =   "±£´æ"
         Top             =   75
         Width           =   240
      End
      Begin VB.Image Image2 
         Height          =   240
         Index           =   0
         Left            =   1700
         Picture         =   "½ØÆÁ.frx":1368
         ToolTipText     =   "³·Ïú"
         Top             =   75
         Width           =   240
      End
      Begin VB.Image Image2 
         Height          =   240
         Index           =   4
         Left            =   1220
         Picture         =   "½ØÆÁ.frx":16F2
         ToolTipText     =   "Ìí¼Ó¼ýÍ·"
         Top             =   75
         Width           =   240
      End
      Begin VB.Image Image2 
         Height          =   240
         Index           =   5
         Left            =   860
         Picture         =   "½ØÆÁ.frx":1A7C
         ToolTipText     =   "Ìí¼ÓÎÄ×Ö"
         Top             =   75
         Width           =   240
      End
      Begin VB.Image Image2 
         Height          =   240
         Index           =   6
         Left            =   480
         Picture         =   "½ØÆÁ.frx":1E06
         ToolTipText     =   "Ìí¼Ó×µÔ²"
         Top             =   75
         Width           =   240
      End
      Begin VB.Image Image2 
         Height          =   240
         Index           =   7
         Left            =   100
         Picture         =   "½ØÆÁ.frx":2190
         ToolTipText     =   "Ìí¼Ó¾ØÐÎ"
         Top             =   75
         Width           =   240
      End
      Begin VB.Image Image2 
         Height          =   240
         Index           =   1
         Left            =   2070
         Picture         =   "½ØÆÁ.frx":251A
         ToolTipText     =   "ÖØ×ö"
         Top             =   75
         Width           =   240
      End
      Begin VB.Shape Shape3 
         BackColor       =   &H00E0E0E0&
         BackStyle       =   1  'Opaque
         BorderColor     =   &H005C6105&
         Height          =   300
         Index           =   7
         Left            =   80
         Top             =   45
         Visible         =   0   'False
         Width           =   300
      End
      Begin VB.Shape Shape3 
         BackColor       =   &H00E0E0E0&
         BackStyle       =   1  'Opaque
         BorderColor     =   &H005C6105&
         Height          =   300
         Index           =   6
         Left            =   450
         Top             =   45
         Visible         =   0   'False
         Width           =   300
      End
      Begin VB.Shape Shape3 
         BackColor       =   &H00E0E0E0&
         BackStyle       =   1  'Opaque
         BorderColor     =   &H005C6105&
         Height          =   300
         Index           =   5
         Left            =   820
         Top             =   45
         Visible         =   0   'False
         Width           =   300
      End
      Begin VB.Shape Shape3 
         BackColor       =   &H00E0E0E0&
         BackStyle       =   1  'Opaque
         BorderColor     =   &H005C6105&
         Height          =   300
         Index           =   4
         Left            =   1200
         Top             =   45
         Visible         =   0   'False
         Width           =   300
      End
      Begin VB.Shape Shape3 
         BackColor       =   &H00E0E0E0&
         BackStyle       =   1  'Opaque
         BorderColor     =   &H005C6105&
         Height          =   300
         Index           =   1
         Left            =   2040
         Top             =   45
         Visible         =   0   'False
         Width           =   300
      End
      Begin VB.Shape Shape3 
         BackColor       =   &H00E0E0E0&
         BackStyle       =   1  'Opaque
         BorderColor     =   &H005C6105&
         Height          =   300
         Index           =   0
         Left            =   1670
         Top             =   45
         Visible         =   0   'False
         Width           =   300
      End
      Begin VB.Shape Shape3 
         BackColor       =   &H00E0E0E0&
         BackStyle       =   1  'Opaque
         BorderColor     =   &H005C6105&
         Height          =   300
         Index           =   2
         Left            =   2410
         Top             =   45
         Visible         =   0   'False
         Width           =   300
      End
      Begin VB.Shape Shape3 
         BackColor       =   &H00E0E0E0&
         BackStyle       =   1  'Opaque
         BorderColor     =   &H005C6105&
         Height          =   300
         Index           =   3
         Left            =   3210
         Top             =   45
         Visible         =   0   'False
         Width           =   300
      End
      Begin VB.Shape Shape2 
         BackColor       =   &H00E0E0E0&
         BackStyle       =   1  'Opaque
         BorderColor     =   &H00494849&
         Height          =   390
         Left            =   0
         Top             =   0
         Width           =   3620
      End
   End
   Begin VB.TextBox TextEdit 
      BackColor       =   &H00FFFFFF&
      ForeColor       =   &H00000000&
      Height          =   240
      Left            =   2400
      TabIndex        =   0
      Top             =   1200
      Visible         =   0   'False
      Width           =   1695
   End
   Begin VB.PictureBox Picture2 
      BackColor       =   &H00C0C0C0&
      BorderStyle     =   0  'None
      Height          =   560
      Left            =   0
      ScaleHeight     =   37
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   241
      TabIndex        =   1
      Top             =   390
      Visible         =   0   'False
      Width           =   3620
      Begin VB.PictureBox PicColor 
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   0  'None
         Height          =   440
         Left            =   1200
         ScaleHeight     =   435
         ScaleWidth      =   2415
         TabIndex        =   6
         Top             =   60
         Width           =   2415
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H00000000&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   0
            Left            =   480
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   23
            Top             =   0
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H00808080&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   1
            Left            =   720
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   22
            Top             =   0
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H000000C0&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   2
            Left            =   960
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   21
            Top             =   0
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H0000C0C0&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   3
            Left            =   1200
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   20
            Top             =   0
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H00008000&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   4
            Left            =   1440
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   19
            Top             =   0
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H00800000&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   5
            Left            =   1680
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   18
            Top             =   0
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H00800080&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   6
            Left            =   1920
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   17
            Top             =   0
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H00808000&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   7
            Left            =   2160
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   16
            Top             =   0
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFFFF&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   8
            Left            =   480
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   15
            Top             =   220
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H00C0C0C0&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   9
            Left            =   720
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   14
            Top             =   220
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H000000FF&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   10
            Left            =   960
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   13
            Top             =   220
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H0000FFFF&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   11
            Left            =   1200
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   12
            Top             =   220
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H0000FF00&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   12
            Left            =   1440
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   11
            Top             =   220
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H00FF0000&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   13
            Left            =   1680
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   10
            Top             =   220
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H00FF00FF&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   14
            Left            =   1920
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   9
            Top             =   220
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFF00&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   200
            Index           =   15
            Left            =   2160
            ScaleHeight     =   195
            ScaleWidth      =   195
            TabIndex        =   8
            Top             =   220
            Width           =   200
         End
         Begin VB.PictureBox Pcolor 
            Appearance      =   0  'Flat
            BackColor       =   &H000000FF&
            BorderStyle     =   0  'None
            ForeColor       =   &H80000008&
            Height          =   420
            Index           =   16
            Left            =   20
            ScaleHeight     =   420
            ScaleWidth      =   420
            TabIndex        =   7
            Top             =   0
            Width           =   420
         End
      End
      Begin VB.PictureBox PicFont 
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   0  'None
         Height          =   375
         Left            =   60
         ScaleHeight     =   375
         ScaleWidth      =   1095
         TabIndex        =   2
         Top             =   120
         Width           =   1095
         Begin VB.PictureBox PicCombox 
            AutoSize        =   -1  'True
            BackColor       =   &H00231C09&
            BorderStyle     =   0  'None
            Height          =   330
            Left            =   320
            Picture         =   "½ØÆÁ.frx":28A4
            ScaleHeight     =   330
            ScaleWidth      =   750
            TabIndex        =   3
            Top             =   0
            Width           =   750
            Begin VB.TextBox Text1 
               BackColor       =   &H00FFFFFF&
               BorderStyle     =   0  'None
               ForeColor       =   &H00000000&
               Height          =   200
               Left            =   60
               TabIndex        =   4
               Text            =   "11"
               Top             =   60
               Width           =   340
            End
         End
         Begin VB.ComboBox Combo1 
            Height          =   300
            ItemData        =   "½ØÆÁ.frx":2CAD
            Left            =   320
            List            =   "½ØÆÁ.frx":2CCC
            TabIndex        =   5
            Text            =   "11"
            Top             =   20
            Visible         =   0   'False
            Width           =   735
         End
         Begin VB.Image Image3 
            Height          =   240
            Left            =   0
            Picture         =   "½ØÆÁ.frx":2CF1
            Top             =   40
            Width           =   240
         End
         Begin VB.Image Image4 
            Height          =   330
            Index           =   0
            Left            =   120
            Picture         =   "½ØÆÁ.frx":307B
            Top             =   480
            Width           =   750
         End
         Begin VB.Image Image4 
            Height          =   330
            Index           =   1
            Left            =   960
            Picture         =   "½ØÆÁ.frx":3484
            Top             =   480
            Width           =   750
         End
         Begin VB.Image Image4 
            Height          =   330
            Index           =   2
            Left            =   1800
            Picture         =   "½ØÆÁ.frx":41D6
            Top             =   480
            Width           =   750
         End
      End
      Begin VB.Shape Shape4 
         BackColor       =   &H00E0E0E0&
         BackStyle       =   1  'Opaque
         BorderColor     =   &H00C0C0C0&
         Height          =   555
         Left            =   0
         Top             =   0
         Width           =   3615
      End
   End
   Begin VB.Image DSB 
      Height          =   150
      Index           =   7
      Left            =   3705
      Picture         =   "½ØÆÁ.frx":4F28
      Top             =   2460
      Visible         =   0   'False
      Width           =   150
   End
   Begin VB.Image DSB 
      Height          =   150
      Index           =   6
      Left            =   4035
      Picture         =   "½ØÆÁ.frx":4F85
      Top             =   2460
      Visible         =   0   'False
      Width           =   150
   End
   Begin VB.Image DSB 
      Height          =   150
      Index           =   5
      Left            =   4305
      Picture         =   "½ØÆÁ.frx":4FE2
      Top             =   2460
      Visible         =   0   'False
      Width           =   150
   End
   Begin VB.Image DSB 
      Height          =   150
      Index           =   4
      Left            =   4635
      Picture         =   "½ØÆÁ.frx":503F
      Top             =   2460
      Visible         =   0   'False
      Width           =   150
   End
   Begin VB.Image DSB 
      Height          =   150
      Index           =   3
      Left            =   3630
      Picture         =   "½ØÆÁ.frx":509C
      Top             =   2175
      Visible         =   0   'False
      Width           =   150
   End
   Begin VB.Image DSB 
      Height          =   150
      Index           =   2
      Left            =   3960
      Picture         =   "½ØÆÁ.frx":50F9
      Top             =   2175
      Visible         =   0   'False
      Width           =   150
   End
   Begin VB.Image DSB 
      Height          =   150
      Index           =   1
      Left            =   4230
      Picture         =   "½ØÆÁ.frx":5156
      Top             =   2175
      Visible         =   0   'False
      Width           =   150
   End
   Begin VB.Image DSB 
      Height          =   150
      Index           =   0
      Left            =   4560
      Picture         =   "½ØÆÁ.frx":51B3
      Top             =   2205
      Visible         =   0   'False
      Width           =   150
   End
   Begin VB.Label LblPos 
      AutoSize        =   -1  'True
      BackStyle       =   0  'Transparent
      Caption         =   "¿íX¸ß"
      Enabled         =   0   'False
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00C0C0C0&
      Height          =   210
      Left            =   120
      TabIndex        =   26
      Top             =   2640
      Visible         =   0   'False
      Width           =   525
   End
   Begin VB.Label lblInfo 
      Appearance      =   0  'Flat
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BackStyle       =   0  'Transparent
      Caption         =   "Label2"
      Enabled         =   0   'False
      BeginProperty Font 
         Name            =   "ËÎÌå"
         Size            =   10.5
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00C0C0C0&
      Height          =   210
      Left            =   120
      TabIndex        =   25
      Top             =   2880
      Visible         =   0   'False
      Width           =   630
   End
   Begin VB.Shape Shape1 
      BackColor       =   &H00E0E0E0&
      BorderColor     =   &H00E0E0E0&
      BorderStyle     =   4  'Dash-Dot
      BorderWidth     =   3
      FillColor       =   &H0099FFFF&
      Height          =   480
      Left            =   120
      Top             =   1095
      Visible         =   0   'False
      Width           =   735
   End
End
Attribute VB_Name = "Capture"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
'--------------»­ÎÄ±¾ÓÃº¯Êý----------------------------------------------------
Private Declare Function SetTextColor Lib "gdi32" (ByVal hdc As Long, ByVal crColor As Long) As Long
Private Declare Function TextOut Lib "gdi32" Alias "TextOutA" (ByVal hdc As Long, ByVal X As Long, ByVal Y As Long, ByVal lpString As String, ByVal nCount As Long) As Long
'--------------»­×µÔ²ÓÃº¯Êý----------------------------------------------------
Private Declare Function DeleteObject Lib "gdi32" (ByVal hObject As Long) As Long
'Private Declare Function SelectObject Lib "gdi32" (ByVal hdc As Long, ByVal hObject As Long) As Long
Private Declare Function Ellipse Lib "gdi32" (ByVal hdc As Long, ByVal X1 As Long, ByVal y1 As Long, ByVal X2 As Long, ByVal y2 As Long) As Long
Private Declare Function CreatePen Lib "gdi32" (ByVal nPenStyle As Long, ByVal nWidth As Long, ByVal crColor As Long) As Long
'-------------------------ÏÂÀ­ÁÐ±í¿òÏûÏ¢----------------------------------
Private Declare Function SendMessage Lib "user32" Alias "SendMessageA" (ByVal hwnd As Long, ByVal wMsg As Long, ByVal wParam As Long, lParam As Any) As Long
Const CB_SHOWDROPDOWN = &H14F
Const CB_GETDROPPEDSTATE = &H157
Private Type GUID
Data1 As Long
data2 As Integer
Data3 As Integer
Data4(0 To 7) As Byte
End Type
Private Type GdiplusStartupInput
GdiplusVersion As Long
DebugEventCallback As Long
SuppressBackgroundThread As Long
SuppressExternalCodecs As Long
End Type
Private Type EncoderParameter
GUID As GUID
NumberOfValues As Long
type As Long
Value As Long
End Type
Private Type EncoderParameters
Count As Long
Parameter As EncoderParameter
End Type

Private Declare Function GdiplusStartup Lib "gdiplus" (Token As Long, inputbuf As GdiplusStartupInput, Optional ByVal _
outputbuf As Long = 0) As Long
Private Declare Function GdiplusShutdown Lib "gdiplus" (ByVal Token As Long) As Long
Private Declare Function GdipCreateBitmapFromHBITMAP Lib "gdiplus" (ByVal hbm As Long, ByVal hPal As Long, BITMAP As Long) As Long
Private Declare Function GdipDisposeImage Lib "gdiplus" (ByVal image As Long) As Long
Private Declare Function GdipSaveImageToFile Lib "gdiplus" (ByVal image As Long, ByVal filename As Long, clsidEncoder As _
GUID, encoderParams As Any) As Long
Private Declare Function CLSIDFromString Lib "ole32" (ByVal str As Long, id As GUID) As Long
Private Declare Function CopyMemory Lib "kernel32" Alias "RtlMoveMemory" (Dest As Any, src As Any, ByVal cb As Long) As Long
Private Declare Function PtInRect Lib "user32" (lpRect As RECT, ByVal X As Long, ByVal Y As Long) As Long
Private Declare Function CreateDC Lib "gdi32" Alias "CreateDCA" (ByVal lpDriverName As String, ByVal lpDeviceName As String, ByVal lpOutput As String, lpInitData As Long) As Long
Private Declare Function BitBlt Lib "gdi32" (ByVal hDestDC As Long, ByVal X As Long, ByVal Y As Long, ByVal nWidth As Long, ByVal nHeight As Long, ByVal hSrcDC As Long, ByVal xSrc As Long, ByVal ySrc As Long, ByVal dwRop As Long) As Long
Private Declare Function GetPixel Lib "gdi32" (ByVal hdc As Long, ByVal X As Long, ByVal Y As Long) As Long
Private Declare Function SetWindowPos Lib "user32" (ByVal hwnd As Long, ByVal hWndInsertAfter As Long, ByVal X As Long, ByVal Y As Long, ByVal cx As Long, ByVal cy As Long, ByVal wFlags As Long) As Long
Private Declare Function CreateCompatibleDC Lib "gdi32" (ByVal hdc As Long) As Long
Private Declare Function CreateCompatibleBitmap Lib "gdi32" (ByVal hdc As Long, ByVal nWidth As Long, ByVal nHeight As Long) As Long
Private Declare Function SelectObject Lib "gdi32" (ByVal hdc As Long, ByVal hObject As Long) As Long
Private Declare Function GetDesktopWindow Lib "user32" () As Long
Private Declare Function OpenClipboard Lib "user32" (ByVal hwnd As Long) As Long
Private Declare Function EmptyClipboard Lib "user32" () As Long
Private Declare Function SetClipboardData Lib "user32" (ByVal wFormat As Long, ByVal hMem As Long) As Long
Private Declare Function CloseClipboard Lib "user32" () As Long
Private Declare Function DeleteDC Lib "gdi32" (ByVal hdc As Long) As Long
Private Declare Function ReleaseDC Lib "user32" (ByVal hwnd As Long, ByVal hdc As Long) As Long
Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
Private Declare Function GetCursorPos Lib "user32" (lpPoint As POINTAPI) As Long
'------------µ÷ÓÃ±£´æ¶Ô»°¿ò--------------------------------
Private Declare Function GetSaveFileName Lib "comdlg32.dll" Alias "GetSaveFileNameA" (pOPENFILENAME As OPENFILENAME) As Long
Private Type OPENFILENAME
        lStructSize As Long
        hwndOwner As Long
        hInstance As Long
        lpstrFilter As String
        lpstrCustomFilter As String
        nMaxCustFilter As Long
        nFilterIndex As Long
        lpstrFile As String
        nMaxFile As Long
        lpstrFileTitle As String
        nMaxFileTitle As Long
        lpstrInitialDir As String
        lpstrTitle As String
        flags As Long
        nFileOffset As Integer
        nFileExtension As Integer
        lpstrDefExt As String
        lCustData As Long
        lpfnHook As Long
        lpTemplateName As String
End Type

Dim OriginalX As Single   'ÇøÓòÆðµãX×ø±ê
Dim OriginalY As Single   'ÇøÓòÆðµãµÄY×ø±ê
Dim X1 As Single, y1 As Single, LeftL As Single, TopL As Single
Dim NewX As Single
Dim NewY As Single
Dim Status As String      'µ±Ç°×´Ì¬£¨ÕýÔÚÑ¡ÔñÇøÓò»òÕßÍÏ¶¯ÇøÓò£©
Dim ImgMove As String
Dim rc As RECT            'ÇøÓòµÄ·¶Î§
Dim MPoint As POINTAPI
Dim DPoint As POINTAPI
Dim ptInPic As Boolean     'Êó±êÊÇ·ñÎ»ÓÚpicÉÏ
Dim UnloadFrm As Long
Dim Edit As Boolean    'ÊÇ·ñ±à¼­×´Ì¬
Dim EditStr As String  '±à¼­ÄÚÈÝ
Dim START As Boolean
Dim ImgIndex As Long   '¼ÇÂ¼µ¥»÷Image2µÄË÷Òý
Dim X0 As Single, Y0 As Single

Private Type Bytes
 arr() As Byte
End Type
Dim Byt() As Bytes
Dim Indexs As Long, iCount As Long

Private Type POINTAPI
X As Long
Y As Long
End Type

Private Type RECT
    Left As Long
    Top As Long
    Right As Long
    Bottom As Long
End Type
Private Sub GetRGBColors(ByVal RGBColor As Long, ByRef RedColor As Long, ByRef GreenColor As Long, ByRef BlueColor As Long)
    RedColor = RGBColor Mod 256
    GreenColor = (RGBColor \ &H100) Mod 256
    BlueColor = (RGBColor \ &H10000) Mod 256
End Sub

Private Sub Form_Load()
    IS_CAPTURE = True
    Picture1.Top = -Picture1.Height
    Picture1.Visible = False
    Dim SourceDC As Long
    Me.AutoRedraw = True
    Me.ScaleMode = 3
    Screen.MousePointer = vbCrosshair      ' ½«¹â±ê¸ÄÎªÊ®×ÖÐÍ
    SourceDC = CreateDC("DISPLAY", 0, 0, 0)
    BitBlt Me.hdc, 0, 0, Screen.Width / 15, Screen.Height / 15, SourceDC, 0, 0, &HCC0020  '¿½±´µ±Ç°ÆÁÄ»µ½´°Ìå
    DeleteDC SourceDC
    Me.WindowState = 2
    Me.PICTURE = Me.image
    Indexs = Indexs + 1
    ReDim Preserve Byt(Indexs)
    WriteP Byt(Indexs).arr(), Me.PICTURE
    Status = "draw"        '»æÍ¼×´Ì¬
    Edit = False
End Sub


Private Sub Form_KeyPress(KeyAscii As Integer)
    If KeyAscii = vbKeyEscape Then
        Unload Me
    End If
End Sub


Private Sub DSB_MouseDown(Index As Integer, Button As Integer, Shift As Integer, X As Single, Y As Single)
    If Indexs = 1 Then
        Edit = False
    End If
    If Edit = False Then
        If Status = "move" Then
            ImgMove = "Start"
            GetCursorPos DPoint
            LeftL = Shape1.Left: TopL = Shape1.Top
            X1 = Shape1.Left + Shape1.Width: y1 = Shape1.Top + Shape1.Height
            Picture1.Visible = False
            Picture2.Visible = False
             Indexs = 1: iCount = 1
             ReDim Preserve Byt(Indexs)
        End If
    End If
End Sub

Private Sub DSB_MouseMove(Index As Integer, Button As Integer, Shift As Integer, X As Single, Y As Single)
On Error Resume Next
    Select Case Index
    Case 0: Screen.MousePointer = 8
    Case 1: Screen.MousePointer = 7
    Case 2: Screen.MousePointer = 6
    Case 3: Screen.MousePointer = 9
    Case 4: Screen.MousePointer = 6
    Case 5: Screen.MousePointer = 7
    Case 6: Screen.MousePointer = 8
    Case 7: Screen.MousePointer = 9
    End Select
    If ImgMove = "Start" Then
        GetCursorPos MPoint   'È¡µÃµ±Ç°Êó±êÎ»ÖÃ
        DSB(Index).Move MPoint.X, MPoint.Y
        Select Case Index
        Case 0   '×óÉÏÒÆ¶¯
            Shape1.Move MPoint.X + DSB(Index).Width / 2, MPoint.Y + DSB(Index).Height / 2, X1 - MPoint.X, y1 - MPoint.Y
        Case 1   'ÉÏÒÆ¶¯
            Shape1.Move LeftL, MPoint.Y + DSB(Index).Height / 2, X1 - LeftL, y1 - MPoint.Y
        Case 2   'ÓÒÉÏÒÆ¶¯
            Shape1.Move LeftL, MPoint.Y + DSB(Index).Height / 2, (MPoint.X - LeftL) + DSB(Index).Width / 2, y1 - MPoint.Y
        Case 3   '×óÒÆ¶¯
            Shape1.Move MPoint.X + DSB(Index).Width / 2, TopL, X1 - MPoint.X, y1 - TopL
        Case 4   '×óÏÂÒÆ¶¯
            Shape1.Move MPoint.X + DSB(Index).Width / 2, TopL, X1 - MPoint.X, MPoint.Y - TopL
        Case 5  'ÏÂÒÆ¶¯
            Shape1.Move LeftL, TopL, X1 - LeftL, MPoint.Y - TopL
        Case 6  'ÓÒÏÂÒÆ¶¯
            Shape1.Move LeftL, TopL, MPoint.X - LeftL, MPoint.Y - TopL
        Case 7  'ÓÒÒÆ¶¯
            Shape1.Move LeftL, TopL, MPoint.X - LeftL, y1 - TopL
        End Select
        ImageMove
        LblPos.Caption = Shape1.Width & "x" & Shape1.Height
        LblPos.Move Shape1.Left + 2, Shape1.Top + 2
         lblInfo.Move Shape1.Left + 2, LblPos.Top + LblPos.Height + 2
        OriginalX = Shape1.Left
        OriginalY = Shape1.Top
    End If
End Sub

Private Sub DSB_MouseUp(Index As Integer, Button As Integer, Shift As Integer, X As Single, Y As Single)
    ImgMove = "Stop"
    If (Shape1.Top + Shape1.Height + 4 + Picture1.Height) > Screen.Height / 15 Then
        Picture1.Move (Shape1.Left + Shape1.Width) - Picture1.Width, (Shape1.Top + Shape1.Height) - Picture1.Height - 4
    Else
        Picture1.Move (Shape1.Left + Shape1.Width) - Picture1.Width, Shape1.Top + Shape1.Height + 4
    End If
    If Picture1.Left < 0 Then Picture1.Move 0
    Picture1.Visible = True
End Sub

Private Sub Form_Unload(Cancel As Integer)
Screen.MousePointer = 0
IS_CAPTURE = False
Call frmma.iCan
End Sub

Private Sub Image2_Click(Index As Integer)
    Dim I As Integer
    Select Case Index
    Case 0    '³·Ïú
        Indexs = Indexs - 1
        If Indexs > 0 Then
            Set Me.PICTURE = ReadP(Byt(Indexs).arr())
        Else
            Status = "draw"
            Shape1.Visible = False
            Picture1.Visible = False
            Picture2.Visible = False
            LblPos.Visible = False
            lblInfo.Visible = False
            Shape1.Width = 0
            Shape1.Height = 0
            For I = 0 To 7
                DSB(I).Visible = False
            Next
            Indexs = 1
            Edit = False
            ' ReDim Byt(1)
        End If
    Case 2
        Dim PicBool As Boolean
        If Picture2.Visible = True Then PicBool = True Else PicBool = False
        Picture1.Visible = False         'Èç¹ûÑ¡Çø°üº¬²¿·ÖÌáÊ¾Í¼Æ¬£¬ÔòÐèÒª°ÑÍ¼Æ¬ÏÈÒþ²Ø.
        Picture2.Visible = False
        Sleep 10                         'ÓÐÊ±ºòÃ»ÓÐÕâÁ½¾ä»áÊ¹µÃshape1Ò²ÏÔÊ¾ÔÚ½ØÈ¡µÄÇøÓòÀï
        DoEvents
        Shape1.Visible = False
        ScrnCap Shape1.Left, Shape1.Top, Shape1.Left + Shape1.Width, Shape1.Top + Shape1.Height

        Picture1.Visible = True
        If PicBool = True Then Picture2.Visible = True
        Shape1.Visible = True
        '------------------------------------------
        Call CutdSave   '±£´æ½ØÍ¼
        Unload Me
    Case 3
        Unload Me
    Case 4
        Picture2.Left = Picture1.Left
        If (Picture1.Top + Picture1.Height + 3 + Picture2.Height) > Screen.Height / 15 Then
            Picture2.Top = Picture1.Top - Picture2.Height - 3
        Else
            Picture2.Top = Picture1.Top + Picture1.Height + 3
        End If
        PicFont.Visible = False
        PicColor.Left = PicFont.Left
        Picture2.Width = 3620 / 15 - PicFont.Width - 2
        Shape4.Width = Picture2.ScaleWidth
        If Picture2.Visible = False Then
            Picture2.Visible = True
        Else
            If ImgIndex = Index Then Picture2.Visible = False    'Èç¹ûµ±Ç°µ¥»÷µÄ°´Å¥Ë÷ÒýÓë¼ÇÂ¼Ë÷ÒýÏàÍ¬¾Í½«Picture2Òþ²Ø
        End If
        Edit = True
        EditStr = Image2(Index).ToolTipText
    Case 5
        Picture2.Left = Picture1.Left
        If (Picture1.Top + Picture1.Height + 3 + Picture2.Height) > Screen.Height / 15 Then
            Picture2.Top = Picture1.Top - Picture2.Height - 3
        Else
            Picture2.Top = Picture1.Top + Picture1.Height + 3
        End If
        PicFont.Visible = True
        PicColor.Left = 78.667
        Picture2.Width = 3620 / 15
        Shape4.Width = Picture2.ScaleWidth
        If Picture2.Visible = False Then
            Picture2.Visible = True
        Else
            If ImgIndex = Index Then Picture2.Visible = False   'Èç¹ûµ±Ç°µ¥»÷µÄ°´Å¥Ë÷ÒýÓë¼ÇÂ¼Ë÷ÒýÏàÍ¬¾Í½«Picture2Òþ²Ø
        End If
        Edit = True
        EditStr = Image2(Index).ToolTipText
    Case 6
        Picture2.Left = Picture1.Left
        If (Picture1.Top + Picture1.Height + 3 + Picture2.Height) > Screen.Height / 15 Then
            Picture2.Top = Picture1.Top - Picture2.Height - 3
        Else
            Picture2.Top = Picture1.Top + Picture1.Height + 3
        End If
        PicFont.Visible = False
        PicColor.Left = PicFont.Left
        Picture2.Width = 3620 / 15 - PicFont.Width - 2
        Shape4.Width = Picture2.ScaleWidth
        If Picture2.Visible = False Then
            Picture2.Visible = True
        Else
            If ImgIndex = Index Then Picture2.Visible = False   'Èç¹ûµ±Ç°µ¥»÷µÄ°´Å¥Ë÷ÒýÓë¼ÇÂ¼Ë÷ÒýÏàÍ¬¾Í½«Picture2Òþ²Ø
        End If
        Edit = True
        EditStr = Image2(Index).ToolTipText
    Case 7
        Picture2.Left = Picture1.Left
        If (Picture1.Top + Picture1.Height + 3 + Picture2.Height) > Screen.Height / 15 Then
            Picture2.Top = Picture1.Top - Picture2.Height - 3
        Else
            Picture2.Top = Picture1.Top + Picture1.Height + 3
        End If
        PicFont.Visible = False
        PicColor.Left = PicFont.Left
        Picture2.Width = 3620 / 15 - PicFont.Width - 2
        Shape4.Width = Picture2.ScaleWidth
        If Picture2.Visible = False Then
            Picture2.Visible = True
        Else
            If ImgIndex = Index Then Picture2.Visible = False  'Èç¹ûµ±Ç°µ¥»÷µÄ°´Å¥Ë÷ÒýÓë¼ÇÂ¼Ë÷ÒýÏàÍ¬¾Í½«Picture2Òþ²Ø
        End If
        Edit = True
        EditStr = Image2(Index).ToolTipText
    Case 1    'ÖØ×ö
        Indexs = Indexs + 1
        If Indexs <= iCount Then
            Set Me.PICTURE = ReadP(Byt(Indexs).arr())
        Else
            Indexs = iCount
        End If
    End Select
    ImgIndex = Index
End Sub

Private Sub Form_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If Edit = False Then
        Picture1.Visible = False
        If Status = "draw" Then          'Èç¹ûÊÇ×¥È¡×´Ì¬
            Shape1.Visible = True
            Shape1.Width = 0
            Shape1.Height = 0
            OriginalX = X
            OriginalY = Y                'Æðµã×ø±ê
            Shape1.Left = OriginalX
            Shape1.Top = OriginalY
            If Button = 2 Then
                UnloadFrm = 0
            End If
        Else
            Screen.MousePointer = vbCrosshair      ' ½«¹â±ê¸ÄÎªÊ®×ÖÐÍ
            rc.Left = Shape1.Left
            rc.Right = Shape1.Left + Shape1.Width
            rc.Top = Shape1.Top
            rc.Bottom = Shape1.Top + Shape1.Height
            If PtInRect(rc, X, Y) Then     'Èç¹û°´ÏÂµÄµãÎ»ÓÚÇøÓòÄÚ
                NewX = X
                NewY = Y               'ÔòÒÆ¶¯ÇøÓò
                If Button = 2 Then
                    Shape1.Width = 0
                    Shape1.Height = 0
                    OriginalX = X
                    OriginalY = Y
                    Shape1.Left = OriginalX
                    Shape1.Top = OriginalY
                    Shape1.Visible = False
                    LblPos.Visible = False
                    lblInfo.Visible = False
                    For I = 0 To 7
                        DSB(I).Visible = False
                    Next
                    Screen.MousePointer = 0
                    Status = "draw"            '×´Ì¬»Ö¸´µ½×¥È¡
                    UnloadFrm = 1
                End If
            Else                           '·ñÔòÖØÐÂ»­Ò»¸öÇøÓò
                Shape1.Width = 0
                Shape1.Height = 0
                OriginalX = X
                OriginalY = Y
                Shape1.Left = OriginalX
                Shape1.Top = OriginalY
                Shape1.Visible = False
                LblPos.Visible = False
                lblInfo.Visible = False
                For I = 0 To 7
                    DSB(I).Visible = False
                Next
                Screen.MousePointer = 0
                Status = "draw"            '×´Ì¬»Ö¸´µ½×¥È¡
                UnloadFrm = 1
            End If
        End If
    Else
        If X > Shape1.Left And X < Shape1.Left + Shape1.Width And Y > Shape1.Top And Y < Shape1.Top + Shape1.Height Then
            START = True: Me.AutoRedraw = False: X0 = X: Y0 = Y
        End If
    End If
End Sub

Private Sub Form_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If START = True Then    '¿ªÊ¼±à¼­
        Me.AutoRedraw = True
        Dim X2 As Single, y2 As Single
        If START = True Then
            Me.Cls
            If X > Shape1.Left + Shape1.Width Then
                X2 = Shape1.Left + Shape1.Width
            ElseIf X < Shape1.Left Then
                X2 = Shape1.Left
            Else
                X2 = X
            End If
            If Y > Shape1.Top + Shape1.Height Then
                y2 = Shape1.Top + Shape1.Height
            ElseIf Y < Shape1.Top Then
                y2 = Shape1.Top
            Else
                y2 = Y
            End If
            Select Case EditStr
            Case "Ìí¼Ó¼ýÍ·"
                Call Arrow(Me, X0, Y0, X2, y2, 10, Pcolor(16).BackColor)
                '----------½«µ±Ç°´°ÌåImageÉèÖÃÎª´°ÌåPicture----------
                START = False
                Me.PICTURE = Me.image
                Indexs = Indexs + 1
                iCount = Indexs
                ReDim Preserve Byt(Indexs)
                WriteP Byt(Indexs).arr(), Me.PICTURE
            Case "Ìí¼ÓÎÄ×Ö"
                TextEdit.FOREColor = Pcolor(16).BackColor
                Me.FontSize = Text1.Text
                TextEdit.FontSize = Text1.Text
                If TextEdit.Visible = False Then
                    TextEdit.Left = X: TextEdit.Top = Y
                    TextEdit.Width = 375 / 15
                    TextEdit.Visible = True: TextEdit.SetFocus
                Else
                    SetTextColor Me.hdc, Pcolor(16).BackColor
                    TextOut Me.hdc, TextEdit.Left, TextEdit.Top, TextEdit, LenB(StrConv(TextEdit, vbFromUnicode))
                    TextEdit.Visible = False: TextEdit = ""
                    '----------½«µ±Ç°´°ÌåImageÉèÖÃÎª´°ÌåPicture----------
                    START = False
                    Me.PICTURE = Me.image
                    Indexs = Indexs + 1
                    iCount = Indexs
                    ReDim Preserve Byt(Indexs)
                    WriteP Byt(Indexs).arr(), Me.PICTURE
                End If
            Case "Ìí¼Ó×µÔ²"
                'Call MoveCircle(Me, x0, y0, X2, Y2, Pcolor(16).BackColor)
                Dim tmppen As Long
                Dim pen As Long
                pen = CreatePen(0, 1, Pcolor(16).BackColor)  '´´½¨Ò»¸ö»­±Ê
                tmppen = SelectObject(Me.hdc, pen)      'Ñ¡¶¨Ò»¸öË¢×Ó
                Ellipse Me.hdc, X0, Y0, X2, y2       '»­Í¼
                SelectObject Me.hdc, tmppen    'É¾³ý¶ÔÏó
                DeleteObject pen
                '----------½«µ±Ç°´°ÌåImageÉèÖÃÎª´°ÌåPicture----------
                START = False
                Me.PICTURE = Me.image
                Indexs = Indexs + 1
                iCount = Indexs
                ReDim Preserve Byt(Indexs)
                WriteP Byt(Indexs).arr(), Me.PICTURE
            Case "Ìí¼Ó¾ØÐÎ"
                Me.Line (X0, Y0)-(X2, y2), Pcolor(16).BackColor, B     '»­¾ØÐÎ
                '----------½«µ±Ç°´°ÌåImageÉèÖÃÎª´°ÌåPicture----------
                START = False
                Me.PICTURE = Me.image
                Indexs = Indexs + 1
                iCount = Indexs
                ReDim Preserve Byt(Indexs)
                WriteP Byt(Indexs).arr(), Me.PICTURE
            End Select
        End If
    End If

    If Button = 1 Then
        If Status = "draw" Then
            Status = "move"
        End If
        OriginalX = Shape1.Left   '¸üÐÂOriginalX£¬ÒòÎªÑ¡ÔñÇøÓòÊ±¿ÉÄÜ»á³öÏÖshapeµÄrightµã´óÓÚleftµã
        OriginalY = Shape1.Top
        If (Shape1.Top + Shape1.Height + 4 + Picture1.Height) > Screen.Height / 15 Then
            Picture1.Move (Shape1.Left + Shape1.Width) - Picture1.Width, (Shape1.Top + Shape1.Height) - Picture1.Height - 4
        Else
            Picture1.Move (Shape1.Left + Shape1.Width) - Picture1.Width, Shape1.Top + Shape1.Height + 4
        End If
        If Picture1.Left < 0 Then Picture1.Move 0
        Picture1.Visible = True
    Else
        If UnloadFrm = 0 Then Unload Me
    End If

End Sub


Private Sub Form_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim RGBColor As Long, Red As Long, Green As Long, Blue As Long
    X1 = X: y1 = Y
    RGBColor = GetPixel(Me.hdc, X, Y)
    GetRGBColors RGBColor, Red, Green, Blue
    lblInfo.Caption = "RGB(" & Red & "," & Green & "," & Blue & ")"
    Dim Info As String
    If Edit = False Then    '±à¼­×´Ì¬
        If X > Shape1.Left And Y > Shape1.Top And X < (Shape1.Left + Shape1.Width) And Y < (Shape1.Top + Shape1.Height) Then
            Screen.MousePointer = 5
        Else
            Screen.MousePointer = vbCrosshair
        End If
        If Button = 1 Then
            Shape1.Visible = False
            LblPos.Visible = False
            lblInfo.Visible = False
            If Status = "draw" Then            'Èç¹ûÊÇ»æÍ¼×´Ì¬
                If X > OriginalX And Y > OriginalY Then           '¸ù¾ÝÊó±êÎ»ÖÃµ÷Õûshape1µÄ´óÐ¡ºÍÎ»ÖÃ
                    Shape1.Move OriginalX, OriginalY, X - OriginalX, Y - OriginalY
                ElseIf X < OriginalX And Y > OriginalY Then
                    Shape1.Move X, OriginalY, OriginalX - X, Y - OriginalY
                ElseIf X > OriginalX And Y < OriginalY Then
                    Shape1.Move OriginalX, Y, X - OriginalX, OriginalY - Y
                ElseIf X < OriginalX And Y < OriginalY Then
                    Shape1.Move X, Y, OriginalX - X, OriginalY - Y
                End If
                Info = Shape1.Width & "x" & Shape1.Height             'ÏÔÊ¾µ±Ç°ÇøÓòµÄ´óÐ¡
                LblPos.Move Shape1.Left + 2, Shape1.Top + 2
                lblInfo.Move Shape1.Left + 2, LblPos.Top + LblPos.Height + 2
                LblPos.Caption = Info
                Screen.MousePointer = vbCrosshair
            Else                               'Èç¹ûÊÇÒÆ¶¯×´Ì¬
                Screen.MousePointer = 5
                Shape1.Left = OriginalX - (NewX - X)
                Shape1.Top = OriginalY - (NewY - Y)
                If Shape1.Left < 0 Then Shape1.Left = 0   'Ê¹ÇøÓò²»³¬¹ýÆÁÄ»
                If Shape1.Top < 0 Then Shape1.Top = 0
                If Shape1.Left + Shape1.Width > Screen.Width / 15 Then Shape1.Left = Screen.Width / 15 - Shape1.Width
                If Shape1.Top + Shape1.Height > Screen.Height / 15 Then Shape1.Top = Screen.Height / 15 - Shape1.Height
                LblPos.Move Shape1.Left + 2, Shape1.Top + 2
                lblInfo.Move Shape1.Left + 2, LblPos.Top + LblPos.Height + 2
            End If
            Call ImageMove
            Shape1.Visible = True
            LblPos.Visible = True
            lblInfo.Visible = True
        End If
    Else
        Dim X2 As Single, y2 As Single
        If START = True Then     '¿ªÊ¼±à¼­
            Me.Cls
            If X > Shape1.Left + Shape1.Width Then
                X2 = Shape1.Left + Shape1.Width
            ElseIf X < Shape1.Left Then
                X2 = Shape1.Left
            Else
                X2 = X
            End If
            If Y > Shape1.Top + Shape1.Height Then
                y2 = Shape1.Top + Shape1.Height
            ElseIf Y < Shape1.Top Then
                y2 = Shape1.Top
            Else
                y2 = Y
            End If
            Select Case EditStr
            Case "Ìí¼Ó¼ýÍ·"
             Call Arrow(Me, X0, Y0, X2, y2, 10, Pcolor(16).BackColor)
            Case "Ìí¼ÓÎÄ×Ö"
            Case "Ìí¼Ó×µÔ²"
            'Call MoveCircle(Me, x0, y0, X2, Y2, Pcolor(16).BackColor)
                Dim tmppen As Long
                Dim pen As Long
                pen = CreatePen(0, 1, Pcolor(16).BackColor)  '´´½¨Ò»¸ö»­±Ê
                tmppen = SelectObject(Me.hdc, pen)      'Ñ¡¶¨Ò»¸öË¢×Ó
                Ellipse Me.hdc, X0, Y0, X2, y2       '»­Í¼
                SelectObject Me.hdc, tmppen    'É¾³ý¶ÔÏó
                DeleteObject pen
            Case "Ìí¼Ó¾ØÐÎ"
                Me.Line (X0, Y0)-(X2, y2), Pcolor(16).BackColor, B     '»­¾ØÐÎ
            End Select
        End If
    End If
End Sub

Private Sub Form_DblClick()
    If PtInRect(rc, NewX, NewY) Then     '¿´ÊÇ·ñÔÚÇøÓòÄÚ
        Picture1.Visible = False         'Èç¹ûÑ¡Çø°üº¬²¿·ÖÌáÊ¾Í¼Æ¬£¬ÔòÐèÒª°ÑÍ¼Æ¬ÏÈÒþ²Ø.
        Sleep 10                         'ÓÐÊ±ºòÃ»ÓÐÕâÁ½¾ä»áÊ¹µÃshape1Ò²ÏÔÊ¾ÔÚ½ØÈ¡µÄÇøÓòÀï
        DoEvents
        Shape1.Visible = False
        ScrnCap Shape1.Left, Shape1.Top, Shape1.Left + Shape1.Width, Shape1.Top + Shape1.Height
        'MsgBox "Í¼ÏóÒÑ¾­±£´æµ½¼ôÌù°åÖÐ", vbInformation, "ÌáÊ¾"
        Unload Me
    End If
End Sub
Public Sub ScrnCap(Left As Long, Top As Long, Right As Long, Bottom As Long)
    Dim I As Integer
    Shape1.Visible = False               '²»ÐèÒª¿½±´shape
    LblPos.Visible = False
    lblInfo.Visible = False
    For I = 0 To 7
        DSB(I).Visible = False
    Next
    DoEvents
    Dim rWidth As Long
    Dim rHeight As Long
    Dim SourceDC As Long
    Dim DestDC As Long
    Dim BHandle As Long
    Dim Wnd As Long
    Dim DHandle As Long
    rWidth = Right - Left
    rHeight = Bottom - Top
    SourceDC = CreateDC("DISPLAY", 0, 0, 0)
    DestDC = CreateCompatibleDC(SourceDC)
    BHandle = CreateCompatibleBitmap(SourceDC, rWidth, rHeight)
    SelectObject DestDC, BHandle
    BitBlt DestDC, 0, 0, rWidth, rHeight, SourceDC, Left, Top, &HCC0020
    Wnd = GetDesktopWindow
    OpenClipboard Wnd
    EmptyClipboard
    SetClipboardData 2, BHandle
    CloseClipboard
    DeleteDC DestDC
    ReleaseDC DHandle, SourceDC
End Sub

Public Sub MDown(X As Single, Y As Single)

End Sub

'--------------------±£´æ½ØÍ¼-----------------------------------------
Public Function CutdSave()
    Dim sFile As String
    Dim SaveOpen As OPENFILENAME
    Dim PicType As String
    SaveOpen.lStructSize = Len(SaveOpen)
    SaveOpen.hwndOwner = 0&
    SaveOpen.lpstrFile = String$(255, 0)
    SaveOpen.nMaxFile = 255
    SaveOpen.lpstrInitialDir = App.Path
    SaveOpen.lpstrFilter = "PNGÎÄ¼þ(*.PNG)" + Chr$(0) + "*.PNG" + Chr$(0) + "JPEGÎÄ¼þ(*.jpg;*.jpeg)" + Chr$(0) + "*.jpg" + Chr$(0) + "Î»Í¼ÎÄ¼þ(*.Bmp)" + Chr$(0) + "*.Bmp" + Chr$(0) + "GIFÎÄ¼þ(*.gif)" + Chr$(0) + "*.gif" + Chr$(0) + "TIFFÎÄ¼þ(*.TIFF)" + Chr$(0) + "*.tiff" + Chr$(0) + "ËùÓÐÎÄ¼þ(*.*)" + Chr$(0) + "*.*" + Chr$(0)
    SaveOpen.lpstrTitle = "±£´æÎª"
    SaveOpen.nFilterIndex = 1    'ÉèÖÃÄ¬ÈÏÑ¡ÔñÀ©Õ¹ÀàÐÍ
    SaveOpen.lpstrDefExt = "PNG"   '³õÊ¼»¯À©Õ¹Ãû
    'SaveOpen.lpstrFile = FileName    '±£´æÎÄ¼þÃû³Æ
    If GetSaveFileName(SaveOpen) <> 0 Then
        sFile = Left(SaveOpen.lpstrFile, InStr(SaveOpen.lpstrFile, Chr$(0)) - 1)
    Else
        Exit Function
    End If
    'SavePicture Clipboard.GetData(), sFile
    PicType = Right(sFile, Len(sFile) - InStrRev(sFile, "."))
    SavePic Clipboard.GetData(), sFile, PicType
    Clipboard.Clear   ' Çå³ý¼ôÌù°å
End Function

Private Sub Image2_MouseMove(Index As Integer, Button As Integer, Shift As Integer, X As Single, Y As Single)
Dim I As Integer
For I = 0 To 7
Shape3(I).Visible = False
Next
Shape3(Index).Visible = True
End Sub


Private Sub Pcolor_MouseUp(Index As Integer, Button As Integer, Shift As Integer, X As Single, Y As Single)
    Pcolor(16).BackColor = Pcolor(Index).BackColor
End Sub

Private Sub Picture1_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
Screen.MousePointer = 1
For I = 0 To 7
Shape3(I).Visible = False
Next
End Sub
Public Function ImageMove()
    Dim I As Integer
    DSB(0).Move Shape1.Left - (DSB(0).Width / 2), Shape1.Top - (DSB(0).Height / 2)
    DSB(1).Move (Shape1.Left + (Shape1.Width / 2)) - (DSB(0).Width / 2), Shape1.Top - (DSB(0).Height / 2)
    DSB(2).Move (Shape1.Left + (Shape1.Width)) - (DSB(2).Width / 1.5), Shape1.Top - (DSB(2).Height / 2)
    DSB(3).Move Shape1.Left - (DSB(3).Width / 2), Shape1.Top + (Shape1.Height / 2) - (DSB(3).Height / 2)
    DSB(4).Move Shape1.Left - (DSB(4).Width / 2), Shape1.Top + (Shape1.Height) - (DSB(4).Height / 2)
    DSB(5).Move (Shape1.Left + (Shape1.Width / 2)) - (DSB(5).Width / 2), Shape1.Top + (Shape1.Height) - (DSB(5).Height / 2)
    DSB(6).Move (Shape1.Left + (Shape1.Width)) - (DSB(6).Width / 2), Shape1.Top + (Shape1.Height) - (DSB(6).Height / 2)
    DSB(7).Move (Shape1.Left + (Shape1.Width)) - (DSB(7).Width / 2), Shape1.Top + (Shape1.Height / 2) - (DSB(7).Height / 2)
    For I = 0 To 7
        DSB(I).Visible = True
    Next
End Function

'-----------------------------Ôö¼Ó---------------------------------
Private Sub PicCombox_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
PicCombox.PICTURE = Image4(2).PICTURE
OpenCombo Combo1.hwnd
End Sub

Private Sub PicCombox_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
PicCombox.PICTURE = Image4(1).PICTURE
End Sub


Private Sub PicFont_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
PicCombox.PICTURE = Image4(0).PICTURE
End Sub

Private Sub Combo1_Click()
    Text1.Text = Combo1.Text
End Sub

Private Sub Pcolor_MouseMove(Index As Integer, Button As Integer, Shift As Integer, X As Single, Y As Single)
If Index <> 16 Then
Pcolor(Index).BorderStyle = 1
Else
For I = 0 To 15
Pcolor(I).BorderStyle = 0
Next
End If
End Sub

Private Sub PicColor_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
For I = 0 To 15
Pcolor(I).BorderStyle = 0
Next
End Sub

Public Sub OpenCombo(chwnd As Long)   'Ç¿ÖÆµ¯³öCombo1µÄÏÂÀ­ÁÐ±í
   Dim rc As Long
    rc = SendMessage(chwnd, CB_GETDROPPEDSTATE, 0, 0)
    If rc = 0 Then
        SendMessage chwnd, CB_SHOWDROPDOWN, True, 0
    Else
        SendMessage chwnd, CB_SHOWDROPDOWN, False, 0
    End If
End Sub

Private Sub Picture2_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
Screen.MousePointer = 1
End Sub


'-------------------»­¼ýÍ·---------------------
Sub Arrow(pic As Object, X0 As Single, Y0 As Single, X1 As Single, y1 As Single, ArrowLen As Single, Optional Color As Long = 0)
Dim Xa As Single, Ya As Single, Xb As Single, Yb As Single, d As Double
d = Sqr((y1 - Y0) * (y1 - Y0) + (X1 - X0) * (X1 - X0))
If d > 0.0000000001 Then
Xa = X1 + ArrowLen * ((X0 - X1) + (Y0 - y1) / 2) / d
Ya = y1 + ArrowLen * ((Y0 - y1) - (X0 - X1) / 2) / d
Xb = X1 + ArrowLen * ((X0 - X1) - (Y0 - y1) / 2) / d
Yb = y1 + ArrowLen * ((Y0 - y1) + (X0 - X1) / 2) / d
pic.Line (Xa, Ya)-(X1, y1), Color
pic.Line (Xb, Yb)-(X1, y1), Color
pic.Line (X0, Y0)-(X1, y1), Color 'Èç¹û½ö»­¼ýÍ·£¬´Ë¾ä¿ÉÉ¾³ý
End If
End Sub

Private Sub TextEdit_Change()
If Me.TextWidth(TextEdit) > TextEdit.Width Then TextEdit.Width = Me.TextWidth(TextEdit)
End Sub
Public Function WriteP(ByRef pc() As Byte, pic As StdPicture)
'VBÊó±ê»­Ô²²¢ÓÃÊý×é±£´æÃ¿´Î²Ù×÷£¬×öµ½³·Ïú£¬ÖØ×ö
Dim pbag As New PropertyBag
pbag.WriteProperty "pic", pic
pc = pbag.Contents
End Function
Public Function ReadP(ByRef rc() As Byte)
Dim pbagb As New PropertyBag
pbagb.Contents = rc
Set ReadP = pbagb.ReadProperty("pic")
End Function

Public Sub SavePic(ByVal pict As StdPicture, ByVal filename As String, PicType As String, _
Optional ByVal Quality As Byte = 80, _
Optional ByVal TIFF_ColorDepth As Long = 24, _
Optional ByVal TIFF_Compression As Long = 6)
Screen.MousePointer = vbHourglass
Dim tSI As GdiplusStartupInput
Dim lRes As Long
Dim lGDIP As Long
Dim lBitmap As Long
Dim aEncParams() As Byte
On Error GoTo ErrHandle:
tSI.GdiplusVersion = 1 ' ³õÊ¼»¯ GDI+
lRes = GdiplusStartup(lGDIP, tSI)
If lRes = 0 Then ' ´Ó¾ä±ú´´½¨ GDI+ Í¼Ïñ
lRes = GdipCreateBitmapFromHBITMAP(pict.handle, 0, lBitmap)
If lRes = 0 Then
Dim tJpgEncoder As GUID
Dim tParams As EncoderParameters '³õÊ¼»¯½âÂëÆ÷µÄGUID±êÊ¶
Select Case LCase(PicType)
Case "jpg"
CLSIDFromString StrPtr("{557CF401-1A04-11D3-9A73-0000F81EF32E}"), tJpgEncoder
tParams.Count = 1 ' ÉèÖÃ½âÂëÆ÷²ÎÊý
With tParams.Parameter ' Quality
CLSIDFromString StrPtr("{1D5BE4B5-FA4A-452D-9CDD-5DB35105E7EB}"), .GUID ' µÃµ½Quality²ÎÊýµÄGUID±êÊ¶
.NumberOfValues = 1
.type = 4
.Value = VarPtr(Quality)
End With
ReDim aEncParams(1 To Len(tParams))
Call CopyMemory(aEncParams(1), tParams, Len(tParams))
Case "png"
CLSIDFromString StrPtr("{557CF406-1A04-11D3-9A73-0000F81EF32E}"), tJpgEncoder
ReDim aEncParams(1 To Len(tParams))
Case "gif"
CLSIDFromString StrPtr("{557CF402-1A04-11D3-9A73-0000F81EF32E}"), tJpgEncoder
ReDim aEncParams(1 To Len(tParams))
Case "tiff"
CLSIDFromString StrPtr("{557CF405-1A04-11D3-9A73-0000F81EF32E}"), tJpgEncoder
tParams.Count = 2
ReDim aEncParams(1 To Len(tParams) + Len(tParams.Parameter))
With tParams.Parameter
.NumberOfValues = 1
.type = 4
CLSIDFromString StrPtr("{E09D739D-CCD4-44EE-8EBA-3FBF8BE4FC58}"), .GUID ' µÃµ½ColorDepth²ÎÊýµÄGUID±êÊ¶
.Value = VarPtr(TIFF_Compression)
End With
Call CopyMemory(aEncParams(1), tParams, Len(tParams))
With tParams.Parameter
.NumberOfValues = 1
.type = 4
CLSIDFromString StrPtr("{66087055-AD66-4C7C-9A18-38A2310B8337}"), .GUID ' µÃµ½Compression²ÎÊýµÄGUID±êÊ¶
.Value = VarPtr(TIFF_ColorDepth)
End With
Call CopyMemory(aEncParams(Len(tParams) + 1), tParams.Parameter, Len(tParams.Parameter))
Case "bmp" '¿ÉÒÔÌáÇ°Ð´±£´æÎªBMPµÄ´úÂë£¬ÒòÎª²¢Ã»ÓÐÓÃGDI+
SavePicture pict, filename
Screen.MousePointer = vbDefault
Exit Sub
End Select
lRes = GdipSaveImageToFile(lBitmap, StrPtr(filename), tJpgEncoder, aEncParams(1)) '±£´æÍ¼Ïñ
GdipDisposeImage lBitmap ' Ïú»ÙGDI+Í¼Ïñ
End If
GdiplusShutdown lGDIP 'Ïú»Ù GDI+
End If
Screen.MousePointer = vbDefault
Erase aEncParams
Exit Sub
ErrHandle:
Screen.MousePointer = vbDefault
End Sub


